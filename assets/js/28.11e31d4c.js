(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{552:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b2f4ef1d1b94310b1c847de8bbf36f9~tplv-k3u1fbpfcp-watermark.image",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"前置内容-浏览器主要进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置内容-浏览器主要进程"}},[t._v("#")]),t._v(" 前置内容 浏览器主要进程")]),t._v(" "),a("p",[t._v("浏览器是多进程的，主要分为：")]),t._v(" "),a("ul",[a("li",[t._v("浏览器主进程：只有一个，主要控制页面的创建、销毁、网络资源管理、下载等。")]),t._v(" "),a("li",[t._v("第三方插件进程：每一种类型的插件对应一个进程，仅当使用该插件时才创建。")]),t._v(" "),a("li",[t._v("GPU进程：最多一个，用于3D绘制等。")]),t._v(" "),a("li",[t._v("浏览器渲染进程(浏览器内核)：每个Tab页对应一个进程，互不影响。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go1ui2ppplj31280u07wh.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"第一部分-输入网址并解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一部分-输入网址并解析"}},[t._v("#")]),t._v(" 第一部分 输入网址并解析")]),t._v(" "),a("p",[t._v("这里我们只考虑输入的是一个URL 结构字符串，如果是非 URL 结构的字符串，则会用浏览器默认的搜索引擎搜索该字符串。")]),t._v(" "),a("h3",{attrs:{id:"url的组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#url的组成"}},[t._v("#")]),t._v(" URL的组成")]),t._v(" "),a("p",[t._v("URL 主要由 "),a("code",[t._v("协议")]),t._v("、"),a("code",[t._v("主机")]),t._v("、"),a("code",[t._v("端口")]),t._v("、"),a("code",[t._v("路径")]),t._v("、"),a("code",[t._v("查询参数")]),t._v("、"),a("code",[t._v("锚点")]),t._v("6部分组成！")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go0xscinsfj31em044ab1.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"解析url"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析url"}},[t._v("#")]),t._v(" 解析URL")]),t._v(" "),a("p",[t._v("输入URL后，浏览器会解析出协议、主机、端口、路径等信息，并构造一个HTTP请求。")]),t._v(" "),a("ol",[a("li",[t._v("浏览器发送请求前，根据请求头的"),a("code",[t._v("expires")]),t._v("和"),a("code",[t._v("cache-control")]),t._v("判断是否命中（包括是否过期）强缓存策略，如果命中，直接从缓存获取资源，并不会发送请求。如果没有命中，则进入下一步。")]),t._v(" "),a("li",[t._v("没有命中强缓存规则，浏览器会发送请求，根据请求头的"),a("code",[t._v("last-modified")]),t._v("和"),a("code",[t._v("etag")]),t._v("判断是否命中协商缓存，如果命中，直接从缓存获取资源。如果没有命中，则进入下一步。")]),t._v(" "),a("li",[t._v("如果前两步都没有命中，则直接从服务端获取资源。")])]),t._v(" "),a("h4",{attrs:{id:"hsts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hsts"}},[t._v("#")]),t._v(" HSTS")]),t._v(" "),a("p",[t._v("由于安全隐患，会使用 HSTS 强制客户端使用 HTTPS 访问页面。详见："),a("a",{attrs:{href:"https://www.barretlee.com/blog/2015/10/22/hsts-intro/",target:"_blank",rel:"noopener noreferrer"}},[t._v("你所不知道的 HSTS"),a("OutboundLink")],1),t._v("。\n当你的网站均采用 HTTPS，并符合它的安全规范，就可以申请加入 HSTS 列表，之后用户不加 HTTPS 协议再去访问你的网站，浏览器都会定向到 HTTPS。无论匹配到没有，都要开始 DNS 查询工作了。")]),t._v(" "),a("h3",{attrs:{id:"浏览器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存"}},[t._v("#")]),t._v(" 浏览器缓存")]),t._v(" "),a("h4",{attrs:{id:"强缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强缓存"}},[t._v("#")]),t._v(" 强缓存")]),t._v(" "),a("p",[t._v("强制缓存就是向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程。强缓存又分为两种"),a("code",[t._v("Expires")]),t._v("和"),a("code",[t._v("Cache-Control")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go245ew8wtj30jx0iuabk.jpg",alt:""}})]),t._v(" "),a("h5",{attrs:{id:"expires"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expires"}},[t._v("#")]),t._v(" Expires")]),t._v(" "),a("ul",[a("li",[t._v("版本：HTTP/1.0")]),t._v(" "),a("li",[t._v("来源：存在于服务端返回的响应头中")]),t._v(" "),a("li",[t._v("语法：Expires: Wed, 22 Nov 2019 08:41:00 GMT")]),t._v(" "),a("li",[t._v("缺点：服务器的时间和浏览器的时间可能并不一致导致失效")])]),t._v(" "),a("h5",{attrs:{id:"cache-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-control"}},[t._v("#")]),t._v(" Cache-Control")]),t._v(" "),a("ul",[a("li",[t._v("版本：HTTP/1.1")]),t._v(" "),a("li",[t._v("来源：响应头和请求头")]),t._v(" "),a("li",[t._v("语法：Cache-Control:max-age=3600")]),t._v(" "),a("li",[t._v("缺点：时间最终还是会失效")])]),t._v(" "),a("p",[t._v("请求头：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段名称")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("no-cache")]),t._v(" "),a("td",[t._v("告知(代理)服务器不直接使用缓存，要求向原服务器发起请求")])]),t._v(" "),a("tr",[a("td",[t._v("no-store")]),t._v(" "),a("td",[t._v("所有内容都不会被保存到缓存或Internet临时文件中")])]),t._v(" "),a("tr",[a("td",[t._v("max-age=delta-seconds")]),t._v(" "),a("td",[t._v("告知服务器客户端希望接收一个存在时间不大于delta-secconds秒的资源")])]),t._v(" "),a("tr",[a("td",[t._v("max-stale[=delta-seconds]")]),t._v(" "),a("td",[t._v("告知(代理)服务器客户端愿意接收一个超过缓存时间的资源，若有定义delta-seconds则为delta-seconds秒，若没有则为任意超出时间")])]),t._v(" "),a("tr",[a("td",[t._v("min-fresh=delta-seconds")]),t._v(" "),a("td",[t._v("告知(代理)服务器客户端希望接收一个在小于delta-seconds秒内被更新过的资源")])]),t._v(" "),a("tr",[a("td",[t._v("no-transform")]),t._v(" "),a("td",[t._v("告知(代理)服务器客户端希望获取实体数据没有被转换(比如压缩)过的资源")])]),t._v(" "),a("tr",[a("td",[t._v("noly-if-cached")]),t._v(" "),a("td",[t._v("告知(代理)服务器客户端希望获取缓存的内容(若有),而不用向原服务器发去请求")])]),t._v(" "),a("tr",[a("td",[t._v("cache-extension")]),t._v(" "),a("td",[t._v("自定义扩展值，若服务器不识别该值将被忽略掉")])])])]),t._v(" "),a("p",[t._v("响应头：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段名称")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("public")]),t._v(" "),a("td",[t._v("表明任何情况下都得缓存该资源(即使是需要HTTP认证的资源)")])]),t._v(" "),a("tr",[a("td",[t._v("Private=[field-name]")]),t._v(" "),a("td",[t._v("表明返回报文中全部或部分(若指定了field-name则为field-name的字段数据)仅开放给某些用户(服务器指定的share-user，如代理服务器)做缓存使用，其他用户则不能缓存这些数据")])]),t._v(" "),a("tr",[a("td",[t._v("no-cache")]),t._v(" "),a("td",[t._v("不直接使用缓存，要求向服务器发起(新鲜度校验)请求")])]),t._v(" "),a("tr",[a("td",[t._v("no-store")]),t._v(" "),a("td",[t._v("所以内容都不会被保存到缓存或Internet临时文件中")])]),t._v(" "),a("tr",[a("td",[t._v("no-transform")]),t._v(" "),a("td",[t._v("告知客户端缓存文件时不得对实体数据做任何改变")])]),t._v(" "),a("tr",[a("td",[t._v("noly-if-cached")]),t._v(" "),a("td",[t._v("告知(代理)服务器客户端希望获取缓存的内容(若有),而不用向原服务器发去请求")])]),t._v(" "),a("tr",[a("td",[t._v("must-revalidate")]),t._v(" "),a("td",[t._v("当前资源一定是向原方法服务器发去验证请求的，如请求是吧会返回504(而非代理服务器上的缓存)")])]),t._v(" "),a("tr",[a("td",[t._v("proxy-revalidate")]),t._v(" "),a("td",[t._v("与must-revalidate类似，但仅能应用于共享缓存(如代理)")])]),t._v(" "),a("tr",[a("td",[t._v("max-age=delta-seconds")]),t._v(" "),a("td",[t._v("告知客户端该资源在delta-seconds秒内是新鲜的，无需向服务器发请求")])]),t._v(" "),a("tr",[a("td",[t._v("s-maxage=delta-seconds")]),t._v(" "),a("td",[t._v("同max-age，但仅能应用于共享缓存(如代理)")])]),t._v(" "),a("tr",[a("td",[t._v("cache-extension")]),t._v(" "),a("td",[t._v("自定义扩展值，若服务器不识别该值将被忽略掉")])])])]),t._v(" "),a("p",[t._v("示例：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// server.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'request come'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/script.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age=20,public'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存20s 多个值用逗号分开")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'console.log(\"script loaded\")'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'server listening on 8888'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("// test.html\n"),a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("en"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width, initial-scale=1.0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("X-UA-Compatible"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ie=edge"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Document"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/script.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://i.imgur.com/gDDrIrc.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"协商缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),a("p",[t._v("协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ba010a1229f477b93e3432e5e8be509~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("h5",{attrs:{id:"模拟last-modified"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模拟last-modified"}},[t._v("#")]),t._v(" 模拟Last-Modified")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" filePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拼接当前脚本文件地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("statSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取当前脚本状态")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toGMTString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件的最后修改时间")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" requestMtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-modified-since'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 来自浏览器传递的值")]),t._v("\n\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" requestMtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 走协商缓存")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mtime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" requestMtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 协商缓存失效，重新读取数据设置 Last-Modified 响应头")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'协商缓存 Last-Modified 失效'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Last-Modified'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" mtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    readStream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc44f282fdb04c7793293885bfed8309~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1be9fb406e1544f3a9c5676d91be15a8~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/40165c39fb75499db999177b9a07e353~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("h5",{attrs:{id:"模拟etag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模拟etag"}},[t._v("#")]),t._v(" 模拟ETag")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" filePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拼接当前脚本文件地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取当前脚本状态")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fileMd5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("md5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件的 md5 值")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" noneMatch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'if-none-match'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 来自浏览器端传递的值")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("noneMatch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" fileMd5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Etag 缓存失效'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age=0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ETag'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fileMd5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readStream "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createReadStream")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    readStream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ecb493eaed974d3e860313f18c02f827~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a450c5d8d98428daa677df1f1ce689d~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),t._v(" "),a("h5",{attrs:{id:"last-modified-响应头-if-modified-since-请求头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#last-modified-响应头-if-modified-since-请求头"}},[t._v("#")]),t._v(" Last-Modified(响应头)，If-Modified-Since(请求头)")]),t._v(" "),a("p",[t._v("在浏览器第一次给服务器发送请求后，服务器会在响应头中加上这个字段。\n浏览器接收到后，如果再次请求，会在请求头中携带"),a("code",[t._v("If-Modified-Since")]),t._v("字段，这个字段的值也就是服务器传来的最后修改时间。\n服务器拿到请求头中的"),a("code",[t._v("If-Modified-Since")]),t._v("的字段后，其实会和这个服务器中该资源的最后修改时间"),a("code",[t._v("Last-Modified")]),t._v("对比,询问服务器在该日期后资源是否有更新，有更新的话就会将新的资源发送回来。")]),t._v(" "),a("p",[t._v("但是如果在本地打开缓存文件，就会造成 "),a("code",[t._v("Last-Modified")]),t._v(" 被修改，所以在 "),a("code",[t._v("HTTP / 1.1")]),t._v(" 出现了 "),a("code",[t._v("ETag")]),t._v("。")]),t._v(" "),a("h5",{attrs:{id:"etag-响应头-、if-none-match-请求头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etag-响应头-、if-none-match-请求头"}},[t._v("#")]),t._v(" ETag(响应头)、If-None-Match(请求头)")]),t._v(" "),a("p",[a("code",[t._v("ETag")]),t._v("是服务器根据当前文件的内容，给文件生成的唯一标识，只要里面的内容有改动，这个值就会变。服务器通过响应头把这个值给浏览器。\n浏览器接收到ETag的值，会在下次请求时，将这个值作为"),a("code",[t._v("If-None-Match")]),t._v("这个字段的内容，并放到请求头中，然后发给服务器。")]),t._v(" "),a("blockquote",[a("p",[t._v("如果两种方式都支持的话，服务器会优先考虑ETag")])]),t._v(" "),a("h4",{attrs:{id:"存储位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储位置"}},[t._v("#")]),t._v(" 存储位置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go112hhj7wj323q0loq9p.jpg",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("Service Worker")])]),t._v(" "),a("p",[a("code",[t._v("Service Worker")]),t._v(" 是运行在浏览器背后的独立线程，一般可以用来实现缓存功能。使用 "),a("code",[t._v("Service Worker")]),t._v("的话，传输协议必须为 "),a("code",[t._v("HTTPS")]),t._v("。因为 "),a("code",[t._v("Service Worker")]),t._v(" 中涉及到请求拦截，所以必须使用 "),a("code",[t._v("HTTPS")]),t._v(" 协议来保障安全。"),a("code",[t._v("Service Worker")]),t._v(" 的缓存与浏览器其他内建的缓存机制不同，它可以让我们自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的。")]),t._v(" "),a("p",[a("code",[t._v("Service Worker")]),t._v(" 实现缓存功能一般分为三个步骤：首先需要先注册 "),a("code",[t._v("Service Worker")]),t._v("，然后监听到 "),a("code",[t._v("install")]),t._v(" 事件以后就可以缓存需要的文件，那么在下次用户访问的时候就可以通过拦截请求的方式查询是否存在缓存，存在缓存的话就可以直接读取缓存文件，否则就去请求数据。")]),t._v(" "),a("p",[t._v("当 "),a("code",[t._v("Service Worker")]),t._v(" 没有命中缓存的时候，我们需要去调用 "),a("code",[t._v("fetch")]),t._v(" 函数获取数据。也就是说，如果我们没有在 "),a("code",[t._v("Service Worker")]),t._v(" 命中缓存的话，会根据缓存查找优先级去查找数据。但是不管我们是从 "),a("code",[t._v("Memory Cache")]),t._v(" 中还是从网络请求中获取的数据，浏览器都会显示我们是从 "),a("code",[t._v("Service Worker")]),t._v("中获取的内容。")]),t._v(" "),a("ul",[a("li",[t._v("Memory Cache")])]),t._v(" "),a("p",[a("code",[t._v("Memory Cache")]),t._v(" 也就是内存中的缓存，主要包含的是当前中页面中已经抓取到的资源,例如页面上已经下载的样式、脚本、图片等。读取内存中的数据肯定比磁盘快,内存缓存虽然读取高效，可是缓存持续性很短，会随着进程的释放而释放。 一旦我们关闭Tab页面，内存中的缓存也就被释放了。")]),t._v(" "),a("p",[t._v("那么既然内存缓存这么高效，我们是不是能让数据都存放在内存中呢？\n这是不可能的。计算机中的内存一定比硬盘容量小得多，操作系统需要精打细算内存的使用，所以能让我们使用的内存必然不多。")]),t._v(" "),a("blockquote",[a("p",[t._v("需要注意的事情是，内存缓存在缓存资源时并不关心返回资源的HTTP缓存头"),a("code",[t._v("Cache-Control")]),t._v("是什么值，同时资源的匹配也并非仅仅是对URL做匹配，还可能会对"),a("code",[t._v("Content-Type")]),t._v("，CORS等其他特征做校验。")])]),t._v(" "),a("ul",[a("li",[t._v("Disk Cache")])]),t._v(" "),a("p",[a("code",[t._v("Disk Cache")]),t._v(" 也就是存储在硬盘中的缓存，读取速度慢点，但是什么都能存储到磁盘中，比之 "),a("code",[t._v("Memory Cache")]),t._v(" 胜在容量和存储时效性上。")]),t._v(" "),a("ul",[a("li",[t._v("Push Cache")])]),t._v(" "),a("p",[a("code",[t._v("Push Cache")]),t._v("（推送缓存）是 "),a("code",[t._v("HTTP/2")]),t._v(" 中的内容，当以上三种缓存都没有命中时，它才会被使用。它只在会话（Session）中存在，一旦会话结束就被释放，并且缓存时间也很短暂，在Chrome浏览器中只有5分钟左右，同时它也并非严格执行HTTP头中的缓存指令。")]),t._v(" "),a("ol",[a("li",[t._v("所有的资源都能被推送，并且能够被缓存,但是 "),a("code",[t._v("Edge")]),t._v(" 和 "),a("code",[t._v("Safari")]),t._v(" 浏览器支持相对比较差")]),t._v(" "),a("li",[t._v("可以推送 "),a("code",[t._v("no-cache")]),t._v(" 和 "),a("code",[t._v("no-store")]),t._v(" 的资源")]),t._v(" "),a("li",[t._v("一旦连接被关闭，"),a("code",[t._v("Push Cache")]),t._v(" 就被释放")]),t._v(" "),a("li",[t._v("多个页面可以使用同一个"),a("code",[t._v("HTTP/2")]),t._v("的连接，也就可以使用同一个"),a("code",[t._v("Push Cache")]),t._v("。这主要还是依赖浏览器的实现而定，出于对性能的考虑，有的浏览器会对相同域名但不同的tab标签使用同一个HTTP连接。")]),t._v(" "),a("li",[a("code",[t._v("Push Cache")]),t._v(" 中的缓存只能被使用一次")]),t._v(" "),a("li",[t._v("浏览器可以拒绝接受已经存在的资源推送")]),t._v(" "),a("li",[t._v("你可以给其他域名推送资源")])]),t._v(" "),a("h3",{attrs:{id:"dns域名解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns域名解析"}},[t._v("#")]),t._v(" DNS域名解析")]),t._v(" "),a("p",[t._v("在发起http请求之前，浏览器首先要做去获得我们想访问网页的IP地址，浏览器会发送一个UDP的包给DNS域名解析服务器。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go12w4rlwaj314e0u0nby.jpg",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"递归查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#递归查询"}},[t._v("#")]),t._v(" 递归查询")]),t._v(" "),a("p",[t._v("我们的浏览器、操作系统、路由器都会缓存一些URL对应的IP地址，统称为DNS高速缓存。这是为了加快DNS解析速度，使得不必每次都到根域名服务器中去查询。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go2ys0b1udj30v602rglx.jpg",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"迭代查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迭代查询"}},[t._v("#")]),t._v(" 迭代查询")]),t._v(" "),a("p",[t._v("迭代查询的方式就是，局部的DNS服务器并不会自己向其他服务器进行查询，而是把能够解析该域名的服务器IP地址返回给客户端，客户端会不断的向这些服务器进行查询，直到查询到了位置，迭代的话只会帮你找到相关的服务器，然后说我现在比较忙，你自己去找吧。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go30d70olzj308c09igmn.jpg",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"dns负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns负载均衡"}},[t._v("#")]),t._v(" DNS负载均衡")]),t._v(" "),a("p",[t._v("DNS还有负载均衡的作用，现在很多网站都有多个服务器，当一个网站访问量过大的时候，如果所有请求都请求在同一个服务器上，可能服务器就会崩掉，这时候就用到了DNS负载均衡技术，当一个网站有多个服务器地址时，在应答DNS查询的时候，DNS服务器会对每个查询返回不同的解析结果，也就是返回不同的IP地址，从而把访问引导到不同的服务器上去，来达到负载均衡的目的。例如可以根据每台机器的负载量，或者该机器距离用户的地理位置距离等等条件。")]),t._v(" "),a("h4",{attrs:{id:"dns预解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns预解析"}},[t._v("#")]),t._v(" DNS预解析")]),t._v(" "),a("p",[t._v("大型网站，有多个不同服务器资源的情况下，都可采取DNS预解析，提前解析，减少页面卡顿。\n"),a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00916370a1a24620a63945f9c7bd1726~tplv-k3u1fbpfcp-watermark.image?",alt:"WeChata927fb47ad19a95887884e244ccc127a.png"}})]),t._v(" "),a("h2",{attrs:{id:"第二部分-tcp-ip连接-三次握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二部分-tcp-ip连接-三次握手"}},[t._v("#")]),t._v(" 第二部分 TCP/IP连接：三次握手")]),t._v(" "),a("h3",{attrs:{id:"网络协议分层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络协议分层"}},[t._v("#")]),t._v(" 网络协议分层")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.imgur.com/Ft5xzr5.gif",alt:""}}),t._v(" "),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNly1gx7y4r4djnj30jq0k276h.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"tcp-ip协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp-ip协议"}},[t._v("#")]),t._v(" TCP/IP协议")]),t._v(" "),a("p",[t._v("TCP(Transmission Control Protocol)传输控制协议。\nTCP/IP协议将应用层、表示层、会话层合并为应用层，物理层和数据链路层合并为网络接口层。")]),t._v(" "),a("blockquote",[a("p",[t._v("TCP/IP协议不仅仅指的是TCP和IP两个协议，⽽是指的⼀个由FTP,SMTP,TCP,UDP,IP,ARP等等协议构成的协议集合。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1go30z8nxlsj319e0i4tfy.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"三次握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[t._v("#")]),t._v(" 三次握手")]),t._v(" "),a("p",[t._v("客服端和服务端在进行http请求和返回的工程中，需要创建一个"),a("code",[t._v("TCP connection")]),t._v("（由客户端发起）,"),a("code",[t._v("http")]),t._v("不存在连接这个概念，它只有请求和响应。请求和响应都是数据包，它们之间的传输通道就是"),a("code",[t._v("TCP connection")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go46k97n4mj20wc0lodia.jpg",alt:""}})]),t._v(" "),a("p",[t._v("位码即tcp标志位，有6种标示：")]),t._v(" "),a("ul",[a("li",[t._v("SYN(synchronous建立联机)")]),t._v(" "),a("li",[t._v("ACK(acknowledgement 确认)")]),t._v(" "),a("li",[t._v("PSH(push传送)")]),t._v(" "),a("li",[t._v("FIN(finish结束)")]),t._v(" "),a("li",[t._v("RST(reset重置)")]),t._v(" "),a("li",[t._v("URG(urgent紧急)")])]),t._v(" "),a("p",[t._v("第一次握手：主机A发送位码为"),a("code",[t._v("SYN＝1")]),t._v("，随机产生"),a("code",[t._v("Seq number=1234567")]),t._v("的数据包到服务器，主机B由"),a("code",[t._v("SYN=1")]),t._v("知道，A要求建立联机；（第一次握手，由浏览器发起，告诉服务器我要发送请求了）")]),t._v(" "),a("p",[t._v("第二次握手：主机B收到请求后要确认联机信息，向A发送"),a("code",[t._v("ack number=(主机A的seq+1)")]),t._v("，"),a("code",[t._v("SUN=1，ACK=1234567 + 1")]),t._v("，随机产生"),a("code",[t._v("Seq=7654321")]),t._v("的包；（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）")]),t._v(" "),a("p",[t._v("第三次握手：主机A收到后检查"),a("code",[t._v("ack number")]),t._v("是否正确，即第一次发送的"),a("code",[t._v("seq number+1")]),t._v("，以及位码"),a("code",[t._v("SYN")]),t._v("是否为1，若正确，主机A会再发送"),a("code",[t._v("ack number=(主机B的seq+1)")]),t._v("，"),a("code",[t._v("ack=7654321 + 1")]),t._v("，主机B收到后确认"),a("code",[t._v("Seq")]),t._v("值与"),a("code",[t._v("ACK=7654321+ 1")]),t._v("则连接建立成功；（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）")]),t._v(" "),a("blockquote",[a("p",[t._v("总是要问：为什么需要三次握手，两次不行吗？其实这是由TCP的自身特点"),a("strong",[t._v("可靠传输")]),t._v("决定的。客户端和服务端要进行可靠传输，那么就需要"),a("strong",[t._v("确认双方的"),a("code",[t._v("接收")]),t._v("和"),a("code",[t._v("发送")]),t._v("能力")]),t._v("。第一次握手可以确认客服端的"),a("code",[t._v("发送能力")]),t._v(",第二次握手，服务端"),a("code",[t._v("SYN=1,Seq=Y")]),t._v("就确认了"),a("code",[t._v("发送能力")]),t._v(","),a("code",[t._v("ACK=X+1")]),t._v("就确认了"),a("code",[t._v("接收能力")]),t._v(",所以第三次握手才可以确认客户端的"),a("code",[t._v("接收能力")]),t._v("。不然容易出现丢包的现象。")])]),t._v(" "),a("h4",{attrs:{id:"第三次握手的必要性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三次握手的必要性"}},[t._v("#")]),t._v(" 第三次握手的必要性？")]),t._v(" "),a("p",[t._v("试想如果是用两次握手，则会出现下面这种情况：\n如客户端发出连接请求，但因连接请求报文丢失而未收到确认，于是客户端再重传一次连接请求。后来收到了确认，建立了连接。数据传输完毕后，就释放了连接，客户端共发出了两个连接请求报文段，其中第一个丢失，第二个到达了服务端，但是第一个丢失的报文段只是在某些网络结点长时间滞留了，延误到连接释放以后的某个时间才到达服务端，此时服务端误认为客户端又发出一次新的连接请求，于是就向客户端发出确认报文段，同意建立连接，不采用三次握手，只要服务端发出确认，就建立新的连接了，此时客户端忽略服务端发来的确认，也不发送数据，则服务端一致等待客户端发送数据，浪费资源。")]),t._v(" "),a("h4",{attrs:{id:"什么是半连接队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是半连接队列"}},[t._v("#")]),t._v(" 什么是半连接队列？")]),t._v(" "),a("p",[t._v("服务器第一次收到客户端的 SYN 之后，就会处于 SYN_RCVD 状态，此时双方还没有完全建立其连接，服务器会把此种状态下请求连接放在一个队列里，我们把这种队列称之为半连接队列。")]),t._v(" "),a("p",[t._v("当然还有一个全连接队列，就是已经完成三次握手，建立起连接的就会放在全连接队列中。如果队列满了就有可能会出现丢包现象。")]),t._v(" "),a("p",[t._v("这里在补充一点关于SYN-ACK 重传次数的问题：\n服务器发送完SYN-ACK包，如果未收到客户确认包，服务器进行首次重传，等待一段时间仍未收到客户确认包，进行第二次重传。如果重传次数超过系统规定的最大重传次数，系统将该连接信息从半连接队列中删除。")]),t._v(" "),a("p",[t._v("注意，每次重传等待的时间不一定相同，一般会是指数增长，例如间隔时间为 1s，2s，4s，8s…")]),t._v(" "),a("h4",{attrs:{id:"isn是固定的吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#isn是固定的吗"}},[t._v("#")]),t._v(" ISN是固定的吗？")]),t._v(" "),a("p",[t._v("当一端为建立连接而发送它的SYN时，它为连接选择一个初始序号。ISN随时间而变化，因此每个连接都将具有不同的ISN。ISN可以看作是一个32比特的计数器，每4ms加1 。这样选择序号的目的在于防止在网络中被延迟的分组在以后又被传送，而导致某个连接的一方对它做错误的解释。")]),t._v(" "),a("p",[t._v("三次握手的其中一个重要功能是客户端和服务端交换 ISN(Initial Sequence Number)，以便让对方知道接下来接收数据的时候如何按序列号组装数据。如果 ISN 是固定的，攻击者很容易猜出后续的确认号，因此 ISN 是动态生成的。")]),t._v(" "),a("h4",{attrs:{id:"三次握手过程中可以携带数据吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三次握手过程中可以携带数据吗"}},[t._v("#")]),t._v(" 三次握手过程中可以携带数据吗？")]),t._v(" "),a("p",[t._v("其实第三次握手的时候，是可以携带数据的。但是，第一次、第二次握手不可以携带数据。")]),t._v(" "),a("p",[t._v("为什么这样呢?大家可以想一个问题，假如第一次握手可以携带数据的话，如果有人要恶意攻击服务器，那他每次都在第一次握手中的 SYN 报文中放入大量的数据。因为攻击者根本就不理服务器的接收、发送能力是否正常，然后疯狂着重复发 SYN 报文的话，这会让服务器花费很多时间、内存空间来接收这些报文。")]),t._v(" "),a("p",[t._v("也就是说，第一次握手不可以放数据，其中一个简单的原因就是会让服务器更加容易受到攻击了。而对于第三次的话，此时客户端已经处于 ESTABLISHED 状态。对于客户端来说，他已经建立起连接了，并且也已经知道服务器的接收、发送能力是正常的了，所以能携带数据也没啥毛病。")]),t._v(" "),a("h4",{attrs:{id:"syn攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syn攻击"}},[t._v("#")]),t._v(" SYN攻击？")]),t._v(" "),a("p",[t._v("服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的SYN包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。SYN 攻击是一种典型的 DoS/DDoS 攻击。")]),t._v(" "),a("p",[t._v("检测 SYN 攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击。在 Linux/Unix 上可以使用系统自带的 netstats 命令来检测 SYN 攻击。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("netstat -n -p TCP | grep SYN_RECV\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("常见的防御 SYN 攻击的方法有如下几种：")]),t._v(" "),a("ul",[a("li",[t._v("缩短超时（SYN Timeout）时间")]),t._v(" "),a("li",[t._v("增加最大半连接数")]),t._v(" "),a("li",[t._v("过滤网关防护")]),t._v(" "),a("li",[t._v("SYN cookies技术")])]),t._v(" "),a("h2",{attrs:{id:"第三部分-http请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第三部分-http请求"}},[t._v("#")]),t._v(" 第三部分 HTTP请求")]),t._v(" "),a("h3",{attrs:{id:"http-发展历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-发展历史"}},[t._v("#")]),t._v(" HTTP 发展历史")]),t._v(" "),a("p",[t._v("HTTP/0.9")]),t._v(" "),a("ul",[a("li",[t._v("[x] 只有一个命令GET")]),t._v(" "),a("li",[t._v("[x] 响应类型: 仅 超文本")]),t._v(" "),a("li",[t._v("[x] 没有header等描述数据的信息")]),t._v(" "),a("li",[t._v("[x] 服务器发送完毕，就关闭TCP连接")])]),t._v(" "),a("p",[t._v("HTTP/1.0")]),t._v(" "),a("ul",[a("li",[t._v("[x] 增加了很多命令（post HESD ）")]),t._v(" "),a("li",[t._v("[x] 增加"),a("code",[t._v("status code")]),t._v(" 和 "),a("code",[t._v("header")])]),t._v(" "),a("li",[t._v("[x] 多字符集支持、多部分发送、权限、缓存等")]),t._v(" "),a("li",[t._v("[x] 响应：不再只限于超文本 (Content-Type 头部提供了传输 HTML 之外文件的能力 — 如脚本、样式或媒体文件)")])]),t._v(" "),a("p",[t._v("HTTP/1.1")]),t._v(" "),a("ul",[a("li",[t._v("[x] 持久连接。TCP三次握手会在任何连接被建立之前发生一次。最终，当发送了所有数据之后，服务器发送一个消息，表示不会再有更多数据向客户端发送了；则客户端才会关闭连接（断开 TCP）")]),t._v(" "),a("li",[t._v("[x] 支持的方法: "),a("code",[t._v("GET")]),t._v(" , "),a("code",[t._v("HEAD")]),t._v(" , "),a("code",[t._v("POST")]),t._v(" , "),a("code",[t._v("PUT")]),t._v(" ,"),a("code",[t._v("DELETE")]),t._v(" , "),a("code",[t._v("TRACE")]),t._v(" , "),a("code",[t._v("OPTIONS")])]),t._v(" "),a("li",[t._v("[x] 进行了重大的性能优化和特性增强，分块传输、压缩/解压、内容缓存磋商、虚拟主机（有单个IP地址的主机具有多个域名）、更快的响应，以及通过增加缓存节省了更多的带宽")])]),t._v(" "),a("p",[t._v("HTTP2")]),t._v(" "),a("ul",[a("li",[t._v("[x] 所有数据以二进制传输。HTTP1.x是基于文本的，无法保证健壮性，HTTP2.0绝对使用新的二进制格式，方便且健壮")]),t._v(" "),a("li",[t._v("[x] 同一个连接里面发送多个请求不再需要按照顺序来")]),t._v(" "),a("li",[t._v("[x] 头信息压缩以及推送等提高效率的功能")])]),t._v(" "),a("p",[t._v("HTTP3")]),t._v(" "),a("ul",[a("li",[t._v("[x] QUIC“快速UDP互联网连接”（Quick UDP Internet Connections）")])]),t._v(" "),a("p",[t._v("HTTP3 的主要改进在传输层上。传输层不会再有我前面提到的那些繁重的 TCP 连接了。现在，一切都会走 UDP。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://http3-explained.haxx.se/zh/zh",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP3详细介绍"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4emjplncj20rp0ewgmh.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"http协议特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http协议特点"}},[t._v("#")]),t._v(" HTTP协议特点")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("支持客户/服务器模式。")])]),t._v(" "),a("li",[a("p",[t._v("简单快速客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有 GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于 HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。")])]),t._v(" "),a("li",[a("p",[t._v("灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type（Content-Type是HTTP包中用来表示内容类型的标识）加以标记。")])]),t._v(" "),a("li",[a("p",[t._v("无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。")])]),t._v(" "),a("li",[a("p",[t._v("无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。")])])]),t._v(" "),a("blockquote",[a("p",[t._v("现在 HTTP3 最快！")])]),t._v(" "),a("h3",{attrs:{id:"http报文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http报文"}},[t._v("#")]),t._v(" HTTP报文")]),t._v(" "),a("p",[t._v("请求报文：\n"),a("img",{attrs:{src:"https://i.imgur.com/AVQ3UcM.jpg",alt:""}})]),t._v(" "),a("p",[t._v("响应报文：\n"),a("img",{attrs:{src:"https://i.imgur.com/o0vnSMW.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"各协议与http协议关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#各协议与http协议关系"}},[t._v("#")]),t._v(" 各协议与HTTP协议关系")]),t._v(" "),a("ul",[a("li",[t._v("DNS 服务：解析域名至对应的IP地址")]),t._v(" "),a("li",[t._v("HTTP 协议：生成针对目标Web服务器的HTTP请求报文")]),t._v(" "),a("li",[t._v("TCP 协议：将请求报文按序号分割成多个报文段")]),t._v(" "),a("li",[t._v("IP 协议：搜索对方的地址，一边中转一边传送")]),t._v(" "),a("li",[t._v("TCP 协议：按序号以原来的顺序重组请求报文请求的处理结果也同样利用TCP/IP协议向用户进行回传")])]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("TCP是底层通讯协议，定义的是数据传输和连接方式的规范；")])])]),t._v(" "),a("ul",[a("li",[t._v("HTTP是应用层协议，定义的是传输数据的内容的规范；")]),t._v(" "),a("li",[t._v("HTTP协议中的数据是利用TCP协议传输的，所以支持HTTP也就一定支持TCP。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4dzgpbevj20ea0kv769.jpg",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("关于HTTP的东西还有很多，我在最后放了张"),a("a",{attrs:{href:"#%E5%85%B3%E4%BA%8Ehttp"}},[t._v("大图")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" HTTPS")]),t._v(" "),a("p",[t._v("在HTTP的基础上再加一层TLS（传输层安全性协议）或者SSL（安全套接层），就构成了HTTPS协议。")]),t._v(" "),a("p",[t._v("HTTPS 默认工作在 TCP 协议443端口，它的工作流程一般如以下方式：")]),t._v(" "),a("ol",[a("li",[t._v("TCP 三次同步握手")]),t._v(" "),a("li",[t._v("客户端验证服务器数字证书")]),t._v(" "),a("li",[t._v("DH 算法协商对称加密算法的密钥、hash 算法的密钥")]),t._v(" "),a("li",[t._v("SSL 安全加密隧道协商完成")]),t._v(" "),a("li",[t._v("网页以加密的方式传输，用协商的对称加密算法和密钥加密，保证数据机密性；用协商的hash算法进行数据完整性保护，保证数据不被篡改。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4j0lghb5j20u0135n87.jpg",alt:""}})]),t._v(" "),a("ol",[a("li",[t._v("客户端向服务端发送 "),a("code",[t._v("Client Hello")]),t._v(" 消息，其中携带客户端支持的协议版本、加密算法、压缩算法以及客户端生成的随机数；")]),t._v(" "),a("li",[t._v("服务端收到客户端支持的协议版本、加密算法等信息后；\n"),a("ol",[a("li",[t._v("向客户端发送 "),a("code",[t._v("Server Hello")]),t._v(" 消息，并携带选择特定的协议版本、加密方法、会话 ID 以及服务端生成的随机数；")]),t._v(" "),a("li",[t._v("向客户端发送 "),a("code",[t._v("Certificate")]),t._v(" 消息，即服务端的证书链，其中包含证书支持的域名、发行方和有效期等信息；")]),t._v(" "),a("li",[t._v("向客户端发送 "),a("code",[t._v("Server Key Exchange")]),t._v(" 消息，传递公钥以及签名等信息；")]),t._v(" "),a("li",[t._v("向客户端发送可选的消息 "),a("code",[t._v("Certificate Request")]),t._v("，验证客户端的证书；")]),t._v(" "),a("li",[t._v("向客户端发送 "),a("code",[t._v("Server Hello Done")]),t._v(" 消息，通知服务端已经发送了全部的相关信息；")])])]),t._v(" "),a("li",[t._v("客户端收到服务端的协议版本、加密方法、会话 ID 以及证书等信息后，验证服务端的证书；\n"),a("ol",[a("li",[t._v("向服务端发送 "),a("code",[t._v("Client Key Exchange")]),t._v(" 消息，包含使用服务端公钥加密后的随机字符串，即预主密钥（"),a("code",[t._v("Pre Master Secret")]),t._v("）；")]),t._v(" "),a("li",[t._v("向服务端发送 "),a("code",[t._v("Change Cipher Spec")]),t._v(" 消息，通知服务端后面的数据段会加密传输；")]),t._v(" "),a("li",[t._v("向服务端发送 "),a("code",[t._v("Finished")]),t._v(" 消息，其中包含加密后的握手信息；")])])]),t._v(" "),a("li",[t._v("服务端收到 "),a("code",[t._v("Change Cipher Spec")]),t._v(" 和 "),a("code",[t._v("Finished")]),t._v(" 消息后；\n"),a("ol",[a("li",[t._v("向客户端发送 "),a("code",[t._v("Change Cipher Spec")]),t._v(" 消息，通知客户端后面的数据段会加密传输；")]),t._v(" "),a("li",[t._v("向客户端发送 "),a("code",[t._v("Finished")]),t._v(" 消息，验证客户端的 "),a("code",[t._v("Finished")]),t._v(" 消息并完成 TLS 握手；")])])])]),t._v(" "),a("p",[t._v("TLS 握手的关键在于利用通信双发生成的随机字符串和服务端的证书公钥生成一个双方经过协商后的对称密钥，这样通信双方就可以使用这个对称密钥在后续的数据传输中加密消息数据，防止中间人的监听和攻击，保证通讯安全。")]),t._v(" "),a("blockquote",[a("p",[t._v("HTTPS连接 需要7次握手，3次TCP + 4次TSL。")])]),t._v(" "),a("h2",{attrs:{id:"第四部分-服务器处理请求并返回-http-报文"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第四部分-服务器处理请求并返回-http-报文"}},[t._v("#")]),t._v(" 第四部分 服务器处理请求并返回 HTTP 报文")]),t._v(" "),a("p",[t._v("每台服务器上都会安装处理请求的应用——Web Server。常见的Web Server 产品有 "),a("code",[t._v("apache")]),t._v("、"),a("code",[t._v("nginx")]),t._v("、"),a("code",[t._v("IIS")]),t._v(" 或 "),a("code",[t._v("Lighttpd")]),t._v(" 等。")]),t._v(" "),a("p",[t._v("HTTP请求一般可以分为两类，静态资源 和 动态资源。")]),t._v(" "),a("p",[t._v("请求访问静态资源，这个就直接根据url地址去服务器里找就好了。")]),t._v(" "),a("p",[t._v("请求动态资源的话，就需要web server把不同请求，委托给服务器上处理相应请求的程序进行处理（例如 CGI 脚本，JSP 脚本，servlets，ASP 脚本，服务器端 JavaScript，或者一些其它的服务器端技术等），然后返回后台程序处理产生的结果作为响应，发送到客户端。")]),t._v(" "),a("p",[t._v("服务器在处理请求的时候主要有三种方式：")]),t._v(" "),a("ul",[a("li",[t._v("第一种：是用一个线程来处理所有的请求，并且同时只能处理一个请求，但是这样的话性能是非常的低的。")]),t._v(" "),a("li",[t._v("第二种：是每一个请求都给他分配一个线程但是当链接和请求比较多的时候就会导致服务器的cpu不堪重负。")]),t._v(" "),a("li",[t._v("第三种：就是采用复用I/O的方式来处理例如通过epoll方式监视所有链接当链接状态发生改变的时候才去分配空间进行处理。")])]),t._v(" "),a("h2",{attrs:{id:"第五部分-浏览器渲染页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第五部分-浏览器渲染页面"}},[t._v("#")]),t._v(" 第五部分 浏览器渲染页面")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4kvyor71j20kb084t9h.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"dom树"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom树"}},[t._v("#")]),t._v(" DOM树")]),t._v(" "),a("p",[t._v("字节 → 字符 → 令牌 → 节点 → 对象模型。")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("viewport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("width=device-width,initial-scale=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Critical Path"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Hello "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("web performance"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("span")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" students!"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("awesome-photo.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4ky2dyomj20v70ha74t.jpg",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("转换:  浏览器从磁盘或网络读取 HTML 的原始字节，并根据文件的指定编码（例如 UTF-8）将它们转换成各个字符。")]),t._v(" "),a("li",[t._v("令牌化: 浏览器将字符串转换成 W3C HTML5 标准规定的各种令牌，例如，“"),a("html",[t._v("”、“"),a("body",[t._v("”，以及其他尖括号内的字符串。每个令牌都具有特殊含义和一组规则。")])])]),t._v(" "),a("li",[t._v("词法分析:  发出的令牌转换成定义其属性和规则的“对象”。")]),t._v(" "),a("li",[t._v("DOM 构建:  最后，由于 HTML 标记定义不同标记之间的关系（一些标记包含在其他标记内），创建的对象链接在一个树数据结构内，此结构也会捕获原始标记中定义的父项-子项关系: HTML 对象是 body 对象的父项，body 是 paragraph 对象的父项，依此类推。")])]),t._v(" "),a("h3",{attrs:{id:"css-对象模型-cssom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css-对象模型-cssom"}},[t._v("#")]),t._v(" CSS 对象模型 (CSSOM)")]),t._v(" "),a("div",{staticClass:"language-css line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-css"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("body")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 16px "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bold "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("span")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" red "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("p span")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("float")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" right "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4l0gwuprj20s401t3yc.jpg",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4l0hxzk1j20g608b74e.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"布局树layout-tree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布局树layout-tree"}},[t._v("#")]),t._v(" 布局树Layout Tree")]),t._v(" "),a("ul",[a("li",[t._v("DOM 树与 CSSOM 树合并后形成渲染树。")]),t._v(" "),a("li",[t._v("渲染树只包含渲染网页所需的节点。")]),t._v(" "),a("li",[t._v("布局计算每个对象的精确位置和大小。")]),t._v(" "),a("li",[t._v("最后一步是绘制，使用最终渲染树将像素渲染到屏幕上。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4l2gpi9vj20vy0ex3z6.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染"}},[t._v("#")]),t._v(" 渲染")]),t._v(" "),a("p",[t._v("渲染流程：")]),t._v(" "),a("ol",[a("li",[t._v("获取DOM后分割为多个图层")]),t._v(" "),a("li",[t._v("对每个图层的节点计算样式结果\t\t（Recalculate style--样式重计算）")]),t._v(" "),a("li",[t._v("为每个节点生成图形和位置\t\t\t（Layout--重排,回流）")]),t._v(" "),a("li",[t._v("将每个节点绘制填充到图层位图中\t\t（Paint--重绘）")]),t._v(" "),a("li",[t._v("图层作为纹理上传至GPU")]),t._v(" "),a("li",[t._v("组合多个图层到页面上生成最终屏幕图像\t（Composite Layers--图层重组）")])]),t._v(" "),a("h4",{attrs:{id:"创建图层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建图层"}},[t._v("#")]),t._v(" 创建图层")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("position_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("position"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("box_3d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("3d变换"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("will-change"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("will-change"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("transform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://www.baidu.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n\ndiv {width: 100px;height: 100px;}\n.position_ {background: pink;position: fixed;z-index: 20;}\n.box_3d {background: red;transform:  translate3d(100px,30px,10px);}\n.will-change {background: #f12312;will-change: transform;}\n.transform {background: #302912;transform: skew(30deg, 20deg);}\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("在 chrome 上查看 Layers.\n"),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go5oa41uuqj218n0u0dl4.jpg",alt:""}}),t._v("\n如果没有打开Layers,按下图打开：\n"),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go5odxpq9uj20mm0hi40q.jpg",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("知道图层的存在，我们可以手动打开一个图层，通过添加"),a("code",[t._v("transform: translateZ(0)")]),t._v(" 这样回流和重绘的代价就小了，效率就会大大提高。但是不要滥用这个属性，否则会大大增加内存消耗。—— 开启GPU加速。")])]),t._v(" "),a("h4",{attrs:{id:"回流和重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回流和重绘"}},[t._v("#")]),t._v(" 回流和重绘")]),t._v(" "),a("ul",[a("li",[t._v("重绘")])]),t._v(" "),a("p",[t._v("当页面中元素样式的改变并不影响它在文档流中的位置时（例如：color、background-color、visibility等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。")]),t._v(" "),a("ul",[a("li",[t._v("回流")])]),t._v(" "),a("p",[t._v("当Render Tree中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流。")]),t._v(" "),a("blockquote",[a("p",[t._v("回流必将引起重绘，而重绘不一定会引起回流。")])]),t._v(" "),a("p",[t._v("引起回流：")]),t._v(" "),a("ol",[a("li",[t._v("页面首次渲染")]),t._v(" "),a("li",[t._v("浏览器窗口大小发生改变")]),t._v(" "),a("li",[t._v("元素尺寸或位置发生改变")]),t._v(" "),a("li",[t._v("元素内容变化（文字数量或图片大小等等）")]),t._v(" "),a("li",[t._v("元素字体大小变化")]),t._v(" "),a("li",[t._v("添加或者删除可见的DOM元素")]),t._v(" "),a("li",[t._v("激活CSS伪类（例如：:hover）")]),t._v(" "),a("li",[t._v("查询某些属性或调用某些方法")])]),t._v(" "),a("p",[t._v("引起回流的属性和方法：")]),t._v(" "),a("ul",[a("li",[t._v("clientWidth、clientHeight、clientTop、clientLeft")]),t._v(" "),a("li",[t._v("offsetWidth、offsetHeight、offsetTop、offsetLeft")]),t._v(" "),a("li",[t._v("scrollWidth、scrollHeight、scrollTop、scrollLeft")]),t._v(" "),a("li",[t._v("scrollIntoView()、scrollIntoViewIffNeeded()")]),t._v(" "),a("li",[t._v("getComputedStyle()")]),t._v(" "),a("li",[t._v("getBoundingClientRect()")]),t._v(" "),a("li",[t._v("scrollTo()")])]),t._v(" "),a("h5",{attrs:{id:"如何减少回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何减少回流"}},[t._v("#")]),t._v(" 如何减少回流")]),t._v(" "),a("ul",[a("li",[t._v("css")])]),t._v(" "),a("ol",[a("li",[t._v("避免使用table布局;")]),t._v(" "),a("li",[t._v("尽可能在DOM树的最末端改变class;")]),t._v(" "),a("li",[t._v("避免设置多层内联样式;")]),t._v(" "),a("li",[t._v("将动画效果应用到position属性为absolute或fixed的元素上;")]),t._v(" "),a("li",[t._v("避免使用CSS表达式（例如：calc()）。")])]),t._v(" "),a("ul",[a("li",[t._v("JS")])]),t._v(" "),a("ol",[a("li",[t._v("避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。")]),t._v(" "),a("li",[t._v("避免频繁操作DOM，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。")]),t._v(" "),a("li",[t._v("也可以先为元素设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。")]),t._v(" "),a("li",[t._v("避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。")]),t._v(" "),a("li",[t._v("对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。")])]),t._v(" "),a("h2",{attrs:{id:"第六部分-断开连接-tcp-四次分手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第六部分-断开连接-tcp-四次分手"}},[t._v("#")]),t._v(" 第六部分 断开连接：TCP 四次分手")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go5pizu4jkj216e0u0dpz.jpg",alt:""}})]),t._v(" "),a("ol",[a("li",[t._v("刚开始双方都处于established状态，假如是客户端先发起关闭请求")]),t._v(" "),a("li",[t._v("第一次挥手：客户端发送一个FIN报文，报文中会指定一个序列号。此时客户端处于FIN_WAIT1状态")]),t._v(" "),a("li",[t._v("第二次挥手：服务端收到FIN之后，会发送ACK报文，且把客户端的序列号值+1作为ACK报文的序列号值，表明已经收到客户端的报文了，此时服务端处于CLOSE_WAIT状态")]),t._v(" "),a("li",[t._v("第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发送FIN报文，且指定一个序列号。此时服务端处于LAST_ACK的状态")]),t._v(" "),a("li",[t._v("需要过一阵子以确保服务端收到自己的ACK报文之后才会进入CLOSED状态，服务端收到ACK报文之后，就处于关闭连接了，处于CLOSED状态。")])]),t._v(" "),a("h3",{attrs:{id:"挥手为什么需要四次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挥手为什么需要四次"}},[t._v("#")]),t._v(" 挥手为什么需要四次？")]),t._v(" "),a("p",[t._v("因为当服务端收到客户端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当服务端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉客户端，“你发的FIN报文我收到了”。只有等到我服务端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四次挥手。")]),t._v(" "),a("h3",{attrs:{id:"为什么客户端发送ack之后不直接关闭-而是要等一阵子才关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么客户端发送ack之后不直接关闭-而是要等一阵子才关闭"}},[t._v("#")]),t._v(" 为什么客户端发送ACK之后不直接关闭，而是要等一阵子才关闭？")]),t._v(" "),a("p",[t._v("客户端收到服务端的连接释放报文段后，对此发出确认报文段（ACK=1，seq=u+1，ack=w+1），客户端进入TIME_WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，客户端才进入CLOSED状态。如果不等待，客户端直接跑路，当服务端还有很多数据包要给客户端发，且还在路上的时候，若客户端的端口此时刚好被新的应用占用，那么就接收到了无用数据包，造成数据包混乱。")]),t._v(" "),a("h3",{attrs:{id:"为什么time-wait状态需要经过2msl-最大报文生存时间-才能返回到close状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么time-wait状态需要经过2msl-最大报文生存时间-才能返回到close状态"}},[t._v("#")]),t._v(" 为什么TIME_WAIT状态需要经过2MSL（最大报文生存时间）才能返回到CLOSE状态？")]),t._v(" "),a("p",[t._v("理论上，四个报文都发送完毕，就可以直接进入CLOSE状态了，但是可能网络是不可靠的，有可能最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。\n1 个 MSL 确保四次挥手中主动关闭方最后的 ACK 报文最终能达到对端；\n1 个 MSL 确保对端没有收到 ACK 重传的 FIN 报文可以到达。")]),t._v(" "),a("h2",{attrs:{id:"关于http"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于http"}},[t._v("#")]),t._v(" 关于HTTP")]),t._v(" "),a("p",[t._v("如果想要高清大图或者Xmind文件的话，可以私信lian x\n"),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1go4g41xa6xj20u06pub2n.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72b7bbf1ebdd4423b13fe167a64359c6~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("浏览器主进程处理用户 URL 输入：")])]),t._v(" "),a("li",[a("p",[t._v("触发旧页面的 "),a("code",[t._v("beforeunload")]),t._v(" 事件；")])]),t._v(" "),a("li",[a("p",[t._v("判断是搜索内容还是页面请求的 URL；")]),t._v(" "),a("ul",[a("li",[t._v("如果是搜索内容，地址栏会使用浏览器默认的搜索引擎，来合成新的带搜索关键字的URL。")]),t._v(" "),a("li",[t._v("如果判断输入内容符合URL规则，比如输入的是 "),a("code",[t._v("juejin.cn")]),t._v(" 那么地址栏会根据规则，把这段内容加上协议，合成为完整的URL，如 "),a("code",[t._v("https://juejin.cn")]),t._v("。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("浏览器主进程")]),t._v("把收到的 URL 转给"),a("strong",[t._v("网络进程")]),t._v("；")])]),t._v(" "),a("li",[a("p",[t._v("网络进程处理 HTTP 请求：")]),t._v(" "),a("ul",[a("li",[t._v("构建请求；")]),t._v(" "),a("li",[t._v("查找缓存，有缓存就直接返回了；")]),t._v(" "),a("li",[t._v("DNS (基于 UDP)解析，准备 IP 地址及端口号（递归查询，迭代查询），如果没有端口号，http默认80，https默认443；")]),t._v(" "),a("li",[t._v("等待 TCP 队列；")]),t._v(" "),a("li",[t._v("建立 TCP 连接，三次握手（为了确认客户端和服务端的接收和发送能力）；")]),t._v(" "),a("li",[t._v("如果是https请求 还有TSL，四次握手；")]),t._v(" "),a("li",[t._v("排队等待，最多可以发送6个http请求，发送 HTTP 请求（请求行 请求头 请求体）；\n"),a("ul",[a("li",[t._v("chrome 针对同一域名只能建立6个tcp链接，")]),t._v(" "),a("li",[t._v("同一域名下，同一GET请求的并发数是1，也就是说上一个请求结束，才会执行下一个请求，否则置入队列等待发送；")]),t._v(" "),a("li",[t._v("同一域名下，不同GET/POST请求的并发数量是6。当发送的请求数量达到6个，并且都没有得到响应时，后面的请求会置入队列等待发送")])])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3710aa2e4824a439016c65abf3e9511~tplv-k3u1fbpfcp-zoom-1.image",alt:""}})]),t._v(" "),a("ul",[a("li",[a("p",[t._v("检查状态码")]),t._v(" "),a("ul",[a("li",[t._v("如果是301/302，则需要重定向，从Location自动中读取地址，重新进行第4步 ，如果是200，则继续处理请求。")]),t._v(" "),a("li",[t._v("200响应处理：检查响应类型"),a("code",[t._v("Content-Type")]),t._v("，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续的渲染，如果是html则通知浏览器进程准备"),a("strong",[t._v("渲染进程")]),t._v("准备进行渲染。")]),t._v(" "),a("li",[t._v("304 去查询浏览器缓存进行返回（协商缓存）")]),t._v(" "),a("li",[t._v("http/1.1 默认是不会断开(keep-alive)\n"),a("ul",[a("li",[t._v("断开 TCP 连接，四次挥手（接收完响应数据后才会断开 TCP 连接）；")])])])])]),t._v(" "),a("li",[a("p",[t._v("准备渲染进程、提交文档、确认文档被提交")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("网络进程")]),t._v("收到响应头数据，将数据发送给"),a("strong",[t._v("浏览器主进程")]),t._v("；")]),t._v(" "),a("li",[a("strong",[t._v("浏览器主进程")]),t._v("收到"),a("strong",[t._v("网络进程")]),t._v("传来的响应头数据，准备"),a("strong",[t._v("渲染进程")]),t._v("；\n"),a("ul",[a("li",[a("strong",[t._v("浏览器进程")]),t._v("检查当前url是否和之前打开的"),a("strong",[t._v("渲染进程")]),t._v("根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的"),a("strong",[t._v("渲染进程")])])])]),t._v(" "),a("li",[t._v("准备好"),a("strong",[t._v("渲染进程")]),t._v("后，"),a("strong",[t._v("浏览器主进程")]),t._v("向"),a("strong",[t._v("渲染进程")]),t._v("发起“提交文档”的消息；")]),t._v(" "),a("li",[a("strong",[t._v("渲染进程")]),t._v("收到"),a("strong",[t._v("浏览器主进程")]),t._v("传来的“提交文档”消息，之后会与"),a("strong",[t._v("网络进程")]),t._v("建立传输 HTML 页面数据管道；")]),t._v(" "),a("li",[t._v("当"),a("strong",[t._v("网络进程")]),t._v("中的响应体接收完毕，通过"),a("strong",[t._v("管道")]),t._v("将 HTML 页面数据传输给"),a("strong",[t._v("渲染进程")]),t._v("；")]),t._v(" "),a("li",[t._v("当 HTML 页面数据传输完成后，"),a("strong",[t._v("渲染进程")]),t._v("会返回“确认文档提交”消息给"),a("strong",[t._v("浏览器主进程")]),t._v("；")]),t._v(" "),a("li",[a("strong",[t._v("浏览器主进程")]),t._v("收到“确认文档提交”消息后，就会更新浏览器界面的状态，比如安全状态、地址栏 URL、历史记录状态，并刷新 Web 页面；")])])]),t._v(" "),a("li",[a("p",[t._v("渲染阶段")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("渲染进程")]),t._v("将 HTML 脚本解析成浏览器能识别处理的 DOM 树；")]),t._v(" "),a("li",[a("strong",[t._v("渲染进程")]),t._v("将 CSS 脚本解析成浏览器能识别处理的 "),a("code",[t._v("styleSheets")]),t._v("，标准化处理属性值，并完成各节点的样式计算；")]),t._v(" "),a("li",[t._v("创建布局树，忽略不可见的节点，进行布局计算，并将节点的布局信息重写回布局树；")]),t._v(" "),a("li",[t._v("对布局树进行分层，生成分层树（Layer Tree）；如一些复杂的"),a("code",[t._v("3D变换")]),t._v("、"),a("code",[t._v("页面滚动")]),t._v("，或者使用"),a("code",[t._v("z-indexing")]),t._v("做z轴排序等，为了更加方便地实现这些效果，渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树（LayerTree）")]),t._v(" "),a("li",[t._v("为每个图层生成绘制列表，并提交给"),a("strong",[t._v("合成线程")]),t._v("；（每个图层有自己的绘制步骤）")]),t._v(" "),a("li",[a("strong",[t._v("合成线程")]),t._v("进行"),a("strong",[t._v("分块")]),t._v("，并在"),a("strong",[t._v("栅格化")]),t._v("线程池中将"),a("strong",[t._v("图块转化为位图")]),t._v("（含 GPU 栅格化）；（有的图层，太大了，需要滚动才能出现在视口中，这种就需要分块，没必要一次性渲染，影响性能！）\n"),a("ul",[a("li",[t._v("通常，栅格化过程都会使用GPU来加速生成，使用GPU生成位图的过程叫快速栅格化，或者GPU栅格化，生成的位图被保存在GPU内存中。")])])]),t._v(" "),a("li",[a("strong",[t._v("浏览器主进程")]),t._v("viz组件收到合成线程的绘制指令 "),a("code",[t._v("DrawQuad")]),t._v("，先在内存中绘制页面，并最终显示在浏览器标签页上。")])])])]),t._v(" "),a("h2",{attrs:{id:"站在巨人的肩膀上"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#站在巨人的肩膀上"}},[t._v("#")]),t._v(" 站在巨人的肩膀上")]),t._v(" "),a("p",[t._v("在这里对前辈大佬表示敬意，查找了很多资料，如有遗漏，还请见谅。文中如果有误，还望及时指出，感谢！")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.infoq.cn/article/whcobxfbgtphy7ijv1kp",target:"_blank",rel:"noopener noreferrer"}},[t._v("5 分钟看懂 HTTP3"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/158593966",target:"_blank",rel:"noopener noreferrer"}},[t._v("一文带你了解HTTPS"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ljianshu/Blog/issues/24",target:"_blank",rel:"noopener noreferrer"}},[t._v("从URL输入到页面展现到底发生什么？"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://juejin.cn/post/6844903784229896199",target:"_blank",rel:"noopener noreferrer"}},[t._v("从URL输入到页面展现到底发生什么？"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/Hanani_Jia/article/details/83036051",target:"_blank",rel:"noopener noreferrer"}},[t._v("在浏览器上请求一个URL的全部过程"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000006879700",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端经典面试题: 从输入URL到页面加载发生了什么？"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/60950750",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器缓存看这一篇就够了"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://nyimac.gitee.io/2020/12/10/URL%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%81%E7%A8%8B/",target:"_blank",rel:"noopener noreferrer"}},[t._v("从输入URL到浏览器显示页面的流程"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/80551769",target:"_blank",rel:"noopener noreferrer"}},[t._v("在浏览器输入 URL 回车之后发生了什么（超详细版）"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://my.oschina.net/yzbty32/blog/549305",target:"_blank",rel:"noopener noreferrer"}},[t._v("TCP和Http的区别!我都搞懂了,你就别迷糊了!"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://draveness.me/whys-the-design-https-latency/",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么 HTTPS 需要 7 次握手以及 9 倍时延"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("渲染树构建、布局及绘制"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/feng9exe/p/10907959.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器渲染详细过程：重绘、重排和 composite 只是冰山一角"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://yeungkc.com/web-reflow-and-repaint/",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器渲染机制和 Reflow（回流、重排）和 Repaint（重绘）"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000038468748",target:"_blank",rel:"noopener noreferrer"}},[t._v("问我Chrome浏览器的渲染原理（6000字长文）"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/fesfsefgs/article/details/105918451",target:"_blank",rel:"noopener noreferrer"}},[t._v("浅谈浏览器的图层与重绘重排（详细），以及如何用于性能优化"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://abelsu7.top/2018/10/18/http-notes-part-1/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP 笔记 1：Web 基础及简单的 HTTP 协议"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://pic.liaoyongfu.com/2019/1028/%E5%9B%BE%E8%A7%A3HTTP-21%E5%BC%A0%E5%9B%BE%E6%8A%8AHTTP%E5%AE%89%E6%8E%92%E5%BE%97%E6%98%8E%E6%98%8E%E7%99%BD%E7%99%BD.pdf",target:"_blank",rel:"noopener noreferrer"}},[t._v("图解HTTP-21张图把HTTP安排得明明白白"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://http3-explained.haxx.se/zh/zh",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP3"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/158593966",target:"_blank",rel:"noopener noreferrer"}},[t._v("一文带你了解HTTPS"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://blog.poetries.top/browser-working-principle/guide/part1/lesson01.html#%E6%97%A9%E6%9C%9F%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%9E%B6%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器工作原理与实践"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);