(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{582:function(s,a,e){"use strict";e.r(a);var t=e(2),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h0r7tvvu9xj21c00qsjux.jpg",alt:""}})]),s._v(" "),e("blockquote",[e("p",[s._v("以下操作都基于阿某云下的服务器和域名，没有服务器和域名的能不能搞，我没试过！")])]),s._v(" "),e("h2",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),e("p",[s._v("在开始安装之前，需要安装"),e("code",[s._v("device-mapper-persistent-data")]),s._v("和"),e("code",[s._v("lvm2")]),s._v("两个依赖。")]),s._v(" "),e("p",[e("code",[s._v("device-mapper-persistent-data")]),s._v("是"),e("code",[s._v("Linux")]),s._v("下的一个存储驱动，"),e("code",[s._v("Linux")]),s._v("上的高级存储技术。"),e("code",[s._v("Lvm")]),s._v("的作用则是创建逻辑磁盘分区。这里我们使用"),e("code",[s._v("CentOS")]),s._v("的"),e("code",[s._v("Yum")]),s._v("包管理器安装两个依赖：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("依赖安装完毕后，我们将阿里云的"),e("code",[s._v("Docker")]),s._v("镜像源添加进去。可以加速"),e("code",[s._v("Docker")]),s._v("的安装。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("安装完毕，我们就可以使用"),e("code",[s._v("systemctl")]),s._v("启动来启动"),e("code",[s._v("Docker")]),s._v("了。"),e("code",[s._v("systemctl")]),s._v("是"),e("code",[s._v("Linux")]),s._v("的进程管理服务命令，他可以帮助我们启动"),e("code",[s._v("docker")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl start docker\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("接着执行一下"),e("code",[s._v("docker -v")]),s._v("，这条命令可以用来查看"),e("code",[s._v("Docker")]),s._v("安装的版本信息。当然也可以帮助我们查看"),e("code",[s._v("docker")]),s._v("安装状态。如果正常展示版本信息，代表"),e("code",[s._v("Docker")]),s._v("已经安装成功。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc069b16398d425ca61727fe22ad4845~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("h2",{attrs:{id:"配置-github-oauth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-github-oauth"}},[s._v("#")]),s._v(" 配置 Github OAuth")]),s._v(" "),e("p",[s._v("https://docs.drone.io/server/provider/github/")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58e1e2ff6d9f4e0b818396a2e6605bf2~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/280efafc72024d05af1bd46e1209a495~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57c0f29de2e94baea5d44df75adc08b8~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a558a8134ac40c19189b0a3e4f419f7~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bec491e06e44e7cadd0ab3075896d3a~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("blockquote",[e("p",[s._v("Client ID 和 Client Secret需要复制存下来，Client Secret生成之后就隐藏起来了，所以最好复制粘贴到小本本上。")])]),s._v(" "),e("h2",{attrs:{id:"openssl-生成共享密钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openssl-生成共享密钥"}},[s._v("#")]),s._v(" openssl 生成共享密钥")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl rand -hex "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" \nbea26a2221fd8090ea38720fc445eca6\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"安装drone"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装drone"}},[s._v("#")]),s._v(" 安装drone")]),s._v(" "),e("p",[s._v("安装drone镜像")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker pull drone/drone:2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("运行drone")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --volume"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/drone:/data "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_GITHUB_CLIENT_ID"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("your-id "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#github里的id")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_GITHUB_CLIENT_SECRET"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("super-duper-secret "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# github生成的密钥")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RPC_SECRET"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("super-duper-secret "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是用openssl生成的共享密钥")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_SERVER_HOST"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("drone.company.com "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个地址就是drone的可视化操作网页的地址，如果下面不是80端口，应该是这样 drone.company.com:3333")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_SERVER_PROTO"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有证书的话 这里也是http")]),s._v("\n    --publish"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 80端口一般留给nginx 可以换一个 3333:80")]),s._v("\n    --publish"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一般也没配置https这个可以删了")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_USER_CREATE"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username:yourname,admin:true "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个很重要，后面会用到")]),s._v("\n    --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --detach"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("drone "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名称")]),s._v("\n    drone/drone:2 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用的镜像")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("到这里就可以看到页面了:\n如果看不到仓库列表，可以点一下右上角的"),e("code",[s._v("SYNC")]),s._v("按钮，同步一下。\n"),e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/795e8c8517564ae5b8e33e47b3a395dd~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("h3",{attrs:{id:"webhooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webhooks"}},[s._v("#")]),s._v(" Webhooks")]),s._v(" "),e("p",[s._v("在Github的仓库设置里可以检查一下"),e("code",[s._v("Webhooks")]),s._v("。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d2beb8762b7448cad5945069772cc50~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[s._v("其实整个流程和"),e("code",[s._v("jenkins")]),s._v("很像，向代码仓库提交代码更新时，就会自动触发"),e("code",[s._v("Webhooks")]),s._v("，然后"),e("code",[s._v("Drone")]),s._v("就会从代码仓库"),e("code",[s._v("Clone")]),s._v("代码，再通过这个"),e("code",[s._v(".drone.yml")]),s._v("（相当于"),e("code",[s._v("java")]),s._v("使用的"),e("code",[s._v("pom.xml")]),s._v("文件）配置，执行相应的流水线操作。")]),s._v(" "),e("h2",{attrs:{id:"安装runner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装runner"}},[s._v("#")]),s._v(" 安装runner")]),s._v(" "),e("p",[s._v("安装"),e("code",[s._v("runner")]),s._v("镜像")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker pull drone/drone-runner-docker:1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("运行"),e("code",[s._v("runner")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker run --detach "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --volume"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/docker.sock:/var/run/docker.sock "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RPC_PROTO"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是视情况而定")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RPC_HOST"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("drone.company.com "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这就是上面配置的drone.company.com:3333")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RPC_SECRET"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("super-duper-secret "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl生成的密钥")]),s._v("\n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RUNNER_CAPACITY"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --env"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RUNNER_NAME"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my-first-runner "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --publish"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("runner "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" \n    drone/drone-runner-docker:1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("可以通过"),e("code",[s._v("docker logs")]),s._v("查看日志")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker logs runner "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runner就是上面设置的 --name=runner 可以修改")]),s._v("\nINFO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" starting the server INFO"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" successfully \npinged the remote server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"github新建一个测试仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#github新建一个测试仓库"}},[s._v("#")]),s._v(" Github新建一个测试仓库")]),s._v(" "),e("p",[s._v("可以用现成的也可以新建一个，这里不赘述。")]),s._v(" "),e("h3",{attrs:{id:"激活仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#激活仓库"}},[s._v("#")]),s._v(" 激活仓库")]),s._v(" "),e("p",[s._v("在drone上找到对应的仓库settings激活并保存。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd6de1da599a49ab907be20f9a1ed9d4~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("blockquote",[e("p",[s._v("如果上面没配"),e("code",[s._v("DRONE_USER_CREATE")]),s._v("，是看不到trusted的，这样你push代码，构建就会提示"),e("code",[s._v("untrusted")]),s._v("不被信任。")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ba76b4c57bb4c8786e36e0c917786cf~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("h2",{attrs:{id:"drone-yml文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#drone-yml文件"}},[s._v("#")]),s._v(" .drone.yml文件")]),s._v(" "),e("h3",{attrs:{id:"配置ssh-host-和-ssh-password"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置ssh-host-和-ssh-password"}},[s._v("#")]),s._v(" 配置ssh_host 和 ssh_password")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec6b377288794570a4f3da716db12fb2~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[s._v("drone保证了安全访问，我们不用在配置文件明文输出"),e("strong",[s._v("密码")]),s._v("等"),e("strong",[s._v("敏感值")]),s._v("，可以添加"),e("code",[s._v("Secret")]),s._v("，如果觉得没有必要也不用添加，直接在后面的"),e("code",[s._v("drone.yml")]),s._v("文件中配置明文密码就行。")]),s._v(" "),e("p",[e("code",[s._v("host")]),s._v(" 配置你的服务器公网ip：\n"),e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29e1cef672294db388918c6abbc929fc~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v(" "),e("code",[s._v("password")]),s._v(" 配置你ssh登录服务器的密码")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce52c49a32b94930ac5f84964a8697e2~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("h3",{attrs:{id:"编写yml文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写yml文件"}},[s._v("#")]),s._v(" 编写yml文件")]),s._v(" "),e("p",[s._v("本人在yml文件配置这块，可以看一下官方文档：https://docs.drone.io/pipeline/overview/\n下面是网上找的一份配置，放到你的仓库不一定能用，但这份配置示例是一个比较完善的步骤，依样画葫芦吧！")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kind: pipeline\ntype: docker\nname: vite-vue3\n\ntrigger:\n  branch:\n    - master\n\nsteps:\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用缓存")]),s._v("\n  - name: restore-cache\n    image: drillster/drone-volume-cache\n    settings:\n      restore: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      mount:\n        - ./node_modules\n    volumes:\n      - name: node_cache\n        path: /cache\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包")]),s._v("\n  - name: build\n    image: node:16\n    commands:\n      - node -v\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" -v\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" config "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry https://registry.npm.taobao.org -g\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" config "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" sass_binary_site https://npm.taobao.org/mirrors/node-sass/ -g\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" \n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" run build\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新缓存")]),s._v("\n  - name: rebuild-cache\n    image: drillster/drone-volume-cache\n    settings:\n      rebuild: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      mount:\n        - ./node_modules\n    volumes:\n      - name: node_cache\n        path: /cache\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署")]),s._v("\n  - name: deploy\n    image: appleboy/drone-scp\n    settings:\n      host:\n        from_secret: ssh_host "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里就是上面配的secret，也可以明文")]),s._v("\n      username: root "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录名")]),s._v("\n      password: \n        from_secret: ssh_password "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录密码")]),s._v("\n      command_timeout: 3m\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置要将打包户的文件部署到的文件地址")]),s._v("\n      target: /usr/share/nginx/html "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把项目拷贝到target目录")]),s._v("\n      source: dist/* "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包后的那个目录")]),s._v("\n      rm: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      strip_components: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    when:\n      status:\n        - success\n\nvolumes:\n  - name: node_cache\n    host:\n      path: /data/node\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br")])]),e("p",[s._v("打包有时候会出现node内存超出的问题：可以设置"),e("code",[s._v("max_old_space_size")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("vue-cli-service build --max_old_space_size"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d09120a2fb143119642d530d7edcb37~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("blockquote",[e("p",[s._v("小提示，如果对"),e("code",[s._v("drone")]),s._v("和"),e("code",[s._v("yml")]),s._v('文件语法不熟，可以只留下"部署"那一步流程，你本地打包把'),e("code",[s._v("dist")]),s._v("文件"),e("code",[s._v("push")]),s._v("到仓库，就可以很快的体验到“半自动化部署”的快感哦！")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f24d9e1a2dab4e82afddf495b9e3b888~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("h2",{attrs:{id:"如果docker配错了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如果docker配错了"}},[s._v("#")]),s._v(" 如果Docker配错了")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("docker "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有容器")]),s._v("\n\ndocker stop name/id  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过id或者name 停止这个容器")]),s._v("\n\ndocker "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" name/id "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把它删了重来")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/afb005fbf5064b0a85dfa3b095b02f07~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);